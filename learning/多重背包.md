# 多重背包

---

## 基础多重背包问题

### 一、描述

​	设有$n$种物品和一个最大承载量为$M$的背包。

​	第$i$种物品有$num[i]$件，重量为$w[i]$，价值为$c[i]$

​	求解：将哪些物品装入背包可使这些物品的费用总和不超过背包容量，且价值总和最大。

### 二、解法

#### 1. 暴力DP

- 复杂度$O(M\sum num[i])$

#### 2. 二进制拆分

- 复杂度$O(M\sum log(num[i]))$

#### 3. 基于重量分类的单调队列优化

- 转移方程：$f[j]=max\{f[j],f[j-k\times w_i]+k\times v_i\}$
    - 将体积按$j\%w_i$结果进行分类：
        - $f[0],f[w_i],f[2\times w_i], ... ,f[k_0\times w_i]$
        - $f[1],f[w_i+1,f[2\times w_i+1],...,f[k_1\times w_i+1]$
        - $\vdots$
        - $f[w_i-1],f[w_i+(w_i-1)],f[2\times w_i+(w_i-1)],...,f[k_{w_i-1}\times w_i+(w_i-1)]$
    - 观察转移方程，$f[j]$只会从$f[j-k\times w_i]$转移过来，即只会从同一类转移过来
    - 对于每一类，用单调队列维护$f[j-k\times w_i]-k\times v_i$最大值
- 复杂度$O(nM)$

----

## 变式——0-1背包的多重背包优化

### 一、描述

​	有$n$<u>个</u>物品和一个最大承载量为$M$的背包。

​	每个物品有一个体积$w_i$和价值$v_i$

### 二、解法

- 按体积分类，选取同种体积的物品时，一定优先选择价值大的物品。
- 设$f[i][j]$为使用前$i$种体积的物品，体积为$j$的最大价值
- 转移方程$f[i][j]=max\{f[i-1][k]+val(k,j)\}$
- $val(k,j)$表示用第$i$种物品填充$j-k$空间最大价值。
- 由于$val(k,j)$满足四边形不等式，所以DP满足决策单调性。
- 利用决策单调性优化，复杂度$O(nlog(n)+m\ max(w))$

