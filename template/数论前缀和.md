# 数论前缀和

----

###1、

###$\sum_{i=1}^n\sum_{j=1}^n[gcd(i,j)=1]$

​	$\sum_{i=1}^n\sum_{j=1}^n[gcd(i,j)=1]$

  =$\sum_{i=1}^n\sum_{j=1}^n\sum_{d|i,d|j}\mu(d)$

  =$\sum_{d=1}^n\mu(d)\sum_{d\mid i}\sum_{d\mid j }1$

  =$\sum_{d=1}^n\mu(d)\sum_{i=1}^{\lfloor n/d\rfloor}\sum_{j=1}^{\lfloor n/d\rfloor}1$

  =$\sum_{d=1}^n\mu(d)\lfloor \frac{n}{d}\rfloor ^2$

###2、$\sum_{i=1}^n\sum_{j=1}^n[gcd(i,j)=k]$

​	$\sum_{i=1}^n\sum_{j=1}^n[gcd(i,j)=k]$

  =$\sum_{i=1}^n\sum_{j=1}^n\sum_{d|\frac{i}{k},d|\frac{j}{k}}\mu(d)$

  =$\sum_{d=1}^{\lfloor n/k\rfloor}\mu(d)\sum_{dk\mid i}\sum_{dk\mid j }1$

  =$\sum_{d=1}^{\lfloor n/k\rfloor}\mu(d)\sum_{i=1}^{\lfloor n/dk\rfloor}\sum_{j=1}^{\lfloor n/dk\rfloor}1$

  =$\sum_{d=1}^{\lfloor n/k\rfloor}\mu(d)\lfloor \frac{n}{dk}\rfloor ^2$

###3、$\sum_{i=1}^n\sum_{j=1}^ngcd(i,j)$

​	$\sum_{i=1}^n\sum_{j=1}^mgcd(i,j)$

=$\sum_{k=1}^n\sum_{i=1}^n\sum_{j=1}^nk[gcd(i,j)=k]$

=$\sum_{k=1}^nk\sum_{i=1}^n\sum_{j=1}^n[gcd(i,j)=k]$

=$\sum_{k=1}^nk\sum_{d=1}^{\lfloor n/k\rfloor}\mu(d)\lfloor \frac{n}{dk}\rfloor ^2$

​	令$T=dk$

=$\sum_{k=1}^n\sum_{d=1}^{\lfloor n/k\rfloor}k\mu(d)\lfloor \frac{n}{dk}\rfloor ^2$

=$\sum_{T=1}^n\sum_{d\mid T} (\frac{T}{d})\mu(d)\lfloor \frac{n}{T}\rfloor ^2$

=$\sum_{T=1}^n \lfloor\frac{n}{T}\rfloor^2 \sum_{d\mid T}(\frac{T}{d})\mu(d)$

=$\sum_{T=1}^n \lfloor\frac{n}{T}\rfloor^2 \varphi(T)$

###4、$\sum_{i=1}^n\sum_{j=1}^nlcm(i,j)$

​	$\sum_{i=1}^n\sum_{j=1}^nlcm(i,j)$

  =$\sum_{i=1}^n\sum_{j=1}^n\frac{ij}{gcd(i,j)}$

  =$\sum_{k=1}^{n}\sum_{i=1}^n\sum_{j=1}^n\frac{ij}{k[gcd(i,j)=k]}$

  =$\sum_{k=1}^{n}\sum_{i=1}^{\lfloor n/k\rfloor}\sum_{j=1}^{\lfloor n/k\rfloor}\frac{ikjk}{k}{[gcd(i,j)=1]}$

  =$\sum_{k=1}^{n}k\sum_{i=1}^{\lfloor n/k\rfloor}\sum_{j=1}^{\lfloor n/k\rfloor}ij{[gcd(i,j)=1]}$

  =$\sum_{k=1}^{n}k\sum_{i=1}^{\lfloor n/k\rfloor}\sum_{j=1}^{\lfloor n/k\rfloor}ij\sum_{d|i,d|j}\mu(t)$

  =$\sum_{k=1}^{n}k\sum_{d=1}^{\lfloor n/k\rfloor}\mu(d)\sum_{i=1}^{\lfloor n/dk\rfloor}\sum_{j=1}^{\lfloor n/dk\rfloor}idjd$

  =$\sum_{k=1}^{n}k\sum_{d=1}^{\lfloor n/k\rfloor}\mu(d)d^2\sum_{i=1}^{\lfloor n/dk\rfloor}\sum_{j=1}^{\lfloor n/dk\rfloor}ij$

  =$\sum_{k=1}^{n}k\sum_{d=1}^{\lfloor n/k\rfloor}\mu(d)d^2\sum_{i=1}^{\lfloor n/dk\rfloor}i\sum_{j=1}^{\lfloor n/dk\rfloor}j$

​	记$sum(n)=1+2+...+n=\frac{n(n+1)}{2}$

  =$\sum_{k=1}^{n}k\sum_{d=1}^{\lfloor n/k\rfloor}\mu(d)d^2sum(\lfloor n/dk\rfloor)^2$

### 5、

### $\sum_{{a_1}=1}^n\sum_{{a_2}=1}^n...\sum_{{a_x}=1}^n(\Pi_{j=1}^xa_j^k)f(gcd(a_1,a_2,...,a_x))·gcd(a_1,a_2,...,a_x)$

### 其中$f(x)$定义为：如果存在整数$t(t>1)$使得$t^2$是$x$的因子，那么$f(x)=0$，否则$f(x)=1$。

$\sum_{{a_1}=1}^n\sum_{{a_2}=1}^n...\sum_{{a_x}=1}^n(\Pi_{j=1}^xa_j^k)f(gcd(a_1,a_2,...,a_x))·gcd(a_1,a_2,...,a_x)$

 =$\sum_{d=1}^ndf(d)\sum_{{a_1}=1}^n\sum_{{a_2}=1}^n...\sum_{{a_x}=1}^n(\Pi_{j=1}^xa_j^k)[gcd(a_1,a_2,...,a_n)=d]$

 =$\sum_{d=1}^nd^{kx+1}f(d)\sum_{{a_1}=1}^{\lfloor n/d\rfloor}\sum_{{a_2}=1}^{\lfloor n/d\rfloor}...\sum_{{a_x}=1}^{\lfloor n/d\rfloor}(\Pi_{j=1}^xa_j^k)[gcd(a_1,a_2,...,a_n)=1]$

​	根据$\mu *I = d$，有

 =$\sum_{d=1}^nd^{kx+1}f(d)\sum_{{a_1}=1}^{\lfloor n/d\rfloor}\sum_{{a_2}=1}^{\lfloor n/d\rfloor}...\sum_{{a_x}=1}^{\lfloor n/d\rfloor}(\Pi_{j=1}^xa_j^k)\sum_{t\mid a_1,t\mid a_2,...,t\mid a_x}\mu(t)$

 =$\sum_{d=1}^nd(td)^{kx}f(d)\sum_{t=1}^{\lfloor n/d\rfloor}\mu(t)\sum_{{a_1}=1}^{\lfloor n/dt\rfloor}\sum_{{a_2}=1}^{\lfloor n/dt\rfloor}...\sum_{{a_x}=1}^{\lfloor n/dt\rfloor}(\Pi_{j=1}^xa_j^k)$

 =$\sum_{d=1}^nd(td)^{kx}f(d)\sum_{t=1}^{\lfloor n/d\rfloor}\mu(t)\sum_{{a_1}=1}^{\lfloor n/dt\rfloor}a_1^k\sum_{{a_2}=1}^{\lfloor n/dt\rfloor}a_2^k...\sum_{{a_x}=1}^{\lfloor n/dt\rfloor}a_x^k$

 =$\sum_{d=1}^nd(td)^{kx}f(d)\sum_{t=1}^{\lfloor n/d\rfloor}\mu(t)(\sum_{i=1}^{\lfloor n/dt\rfloor}i^k)^x$

​	令$T=dt$

 =$\sum_{d=1}^n\sum_{t=1}^{\lfloor n/d\rfloor}d(td)^{kx}f(d)\mu(t)(\sum_{i=1}^{\lfloor n/dt\rfloor}i^k)^x$

 =$\sum_{T=1}^n\sum_{d|T}d(T)^{kx}f(d)\mu(\frac{T}{d})(\sum_{i=1}^{\lfloor n/T\rfloor}i^k)^x$

 =$\sum_{T=1}^n(T)^{kx}(\sum_{i=1}^{\lfloor n/T\rfloor}i^k)^x\sum_{d|T}df(d)\mu(\frac{T}{d})$

​	注意到$f(x)=|\mu(x)|$，由于$\mu(x)=0,1,-1$，所以亦可以写作$f(x)=\mu(x)^2$（方便计算）。

 =$\sum_{T=1}^n(T)^{kx}(\sum_{i=1}^{\lfloor n/T\rfloor}i^k)^x\sum_{d|T}d\mu(d)^2\mu(\frac{T}{d})$  

​	令$g(T)=\sum_{d|T}d\mu(d)^2\mu(\frac{T}{d}),s(T)=\sum_{i=1}^{T}i^k$

 =$\sum_{T=1}^ns(\lfloor n/T\rfloor)^x(T)^{kx}g(T)$  

​	预处理$s(T),g(T)$并预处理$(T)^{kx}g(T)$的前缀和，那么对于每个n就可以用数论分块$O(\sqrt n)$的回答。

